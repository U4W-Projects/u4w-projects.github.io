---
import { useTranslations } from "../i18n/utils";

const { lang } = Astro.props;
const t = useTranslations(lang);
---

<section id="color-palette" class="color-palette-section">
    <div class="container">
        <h2 class="section-title">{t("color.title")}</h2>
        <p class="section-description">
            {t("color.desc")}
        </p>

        <!-- Color Mode Toggle -->
        <div class="color-mode-toggle">
            <button class="mode-btn active" data-mode="dark"
                >{t("color.mode.dark")}</button
            >
            <button class="mode-btn" data-mode="light"
                >{t("color.mode.light")}</button
            >
        </div>

        <!-- Color Cards - Dark Mode -->
        <div class="color-cards" id="darkModeColors">
            <div class="color-card">
                <div class="color-swatch" style="background-color: #0F172A;">
                    <div
                        style="color: white; text-align: center; padding: 20px;"
                    >
                        <h3 style="color: white; margin-bottom: 10px;">
                            {t("color.bg.primary")}
                        </h3>
                        <p style="color: rgba(255,255,255,0.9);">
                            {t("color.bg.primary.desc.dark")}
                        </p>
                    </div>
                </div>
                <div class="color-info">
                    <h3 class="color-name">{t("color.name.deepSpaceBlue")}</h3>
                    <p class="color-hex">#0F172A</p>
                    <p class="color-description">
                        {t("color.desc.deepSpaceBlue")}
                    </p>
                    <button class="copy-hex" data-color="#0F172A"
                        >Copy HEX</button
                    >
                </div>
            </div>

            <div class="color-card">
                <div class="color-swatch" style="background-color: #1E293B;">
                    <div
                        style="color: white; text-align: center; padding: 20px;"
                    >
                        <h3 style="color: white; margin-bottom: 10px;">
                            {t("color.bg.secondary")}
                        </h3>
                        <p style="color: rgba(255,255,255,0.9);">
                            {t("color.bg.secondary.desc.dark")}
                        </p>
                    </div>
                </div>
                <div class="color-info">
                    <h3 class="color-name">{t("color.name.cosmicGray")}</h3>
                    <p class="color-hex">#1E293B</p>
                    <p class="color-description">
                        {t("color.desc.cosmicGray")}
                    </p>
                    <button class="copy-hex" data-color="#1E293B"
                        >Copy HEX</button
                    >
                </div>
            </div>

            <div class="color-card">
                <div class="color-swatch" style="background-color: #3B82F6;">
                    <div
                        style="color: white; text-align: center; padding: 20px;"
                    >
                        <h3 style="color: white; margin-bottom: 10px;">
                            {t("color.primary")}
                        </h3>
                        <p style="color: rgba(255,255,255,0.9);">
                            {t("color.primary.desc")}
                        </p>
                    </div>
                </div>
                <div class="color-info">
                    <h3 class="color-name">{t("color.name.quantumBlue")}</h3>
                    <p class="color-hex">#3B82F6</p>
                    <p class="color-description">
                        {t("color.desc.quantumBlue")}
                    </p>
                    <button class="copy-hex" data-color="#3B82F6"
                        >Copy HEX</button
                    >
                </div>
            </div>

            <div class="color-card">
                <div class="color-swatch" style="background-color: #F59E0B;">
                    <div
                        style="color: white; text-align: center; padding: 20px;"
                    >
                        <h3 style="color: white; margin-bottom: 10px;">
                            {t("color.accent1")}
                        </h3>
                        <p style="color: rgba(255,255,255,0.9);">
                            {t("color.accent1.desc")}
                        </p>
                    </div>
                </div>
                <div class="color-info">
                    <h3 class="color-name">{t("color.name.stellarAmber")}</h3>
                    <p class="color-hex">#F59E0B</p>
                    <p class="color-description">
                        {t("color.desc.stellarAmber")}
                    </p>
                    <button class="copy-hex" data-color="#F59E0B"
                        >Copy HEX</button
                    >
                </div>
            </div>

            <div class="color-card">
                <div class="color-swatch" style="background-color: #10B981;">
                    <div
                        style="color: white; text-align: center; padding: 20px;"
                    >
                        <h3 style="color: white; margin-bottom: 10px;">
                            {t("color.accent2")}
                        </h3>
                        <p style="color: rgba(255,255,255,0.9);">
                            {t("color.accent2.desc")}
                        </p>
                    </div>
                </div>
                <div class="color-info">
                    <h3 class="color-name">{t("color.name.nebulaGreen")}</h3>
                    <p class="color-hex">#10B981</p>
                    <p class="color-description">
                        {t("color.desc.nebulaGreen")}
                    </p>
                    <button class="copy-hex" data-color="#10B981"
                        >Copy HEX</button
                    >
                </div>
            </div>

            <div class="color-card">
                <div class="color-swatch" style="background-color: #E2E8F0;">
                    <div
                        style="color: #0F172A; text-align: center; padding: 20px;"
                    >
                        <h3 style="color: #0F172A; margin-bottom: 10px;">
                            {t("color.text.light")}
                        </h3>
                        <p style="color: rgba(15,23,42,0.9);">
                            {t("color.text.light.desc")}
                        </p>
                    </div>
                </div>
                <div class="color-info">
                    <h3 class="color-name">{t("color.name.pureWhite")}</h3>
                    <!-- Using relevant name if mapping isn't perfect, or just generic -->
                    <p class="color-hex">#E2E8F0</p>
                    <p class="color-description">{t("color.desc.pureWhite")}</p>
                    <!-- Wait, pure white is for light mode bg. Here it's text. Let's reuse or fix mapping. -->
                    <!-- Re-checking ui.ts: 'color.text.light' is 'Light Text'. 'color.text.light.desc' is description. Card title 'Light Text' fits. -->
                    <button class="copy-hex" data-color="#E2E8F0"
                        >Copy HEX</button
                    >
                </div>
            </div>
        </div>

        <!-- Color Cards - Light Mode -->
        <div class="color-cards" id="lightModeColors" style="display: none;">
            <div class="color-card">
                <div class="color-swatch" style="background-color: #FFFFFF;">
                    <div
                        style="color: #1F2937; text-align: center; padding: 20px;"
                    >
                        <h3 style="color: #1F2937; margin-bottom: 10px;">
                            {t("color.bg.primary")}
                        </h3>
                        <p style="color: rgba(31,41,55,0.9);">
                            {t("color.bg.primary.desc.light")}
                        </p>
                    </div>
                </div>
                <div class="color-info">
                    <h3 class="color-name">{t("color.name.pureWhite")}</h3>
                    <p class="color-hex">#FFFFFF</p>
                    <p class="color-description">{t("color.desc.pureWhite")}</p>
                    <button class="copy-hex" data-color="#FFFFFF"
                        >Copy HEX</button
                    >
                </div>
            </div>

            <div class="color-card">
                <div class="color-swatch" style="background-color: #F5F5F5;">
                    <div
                        style="color: #1F2937; text-align: center; padding: 20px;"
                    >
                        <h3 style="color: #1F2937; margin-bottom: 10px;">
                            {t("color.bg.secondary")}
                        </h3>
                        <p style="color: rgba(31,41,55,0.9);">
                            {t("color.bg.secondary.desc.light")}
                        </p>
                    </div>
                </div>
                <div class="color-info">
                    <h3 class="color-name">{t("color.name.lightGray")}</h3>
                    <p class="color-hex">#F5F5F5</p>
                    <p class="color-description">{t("color.desc.lightGray")}</p>
                    <button class="copy-hex" data-color="#F5F5F5"
                        >Copy HEX</button
                    >
                </div>
            </div>

            <div class="color-card">
                <div class="color-swatch" style="background-color: #1E3A8A;">
                    <div
                        style="color: white; text-align: center; padding: 20px;"
                    >
                        <h3 style="color: white; margin-bottom: 10px;">
                            {t("color.primary")}
                        </h3>
                        <p style="color: rgba(255,255,255,0.9);">
                            {t("color.primary.desc")}
                        </p>
                    </div>
                </div>
                <div class="color-info">
                    <h3 class="color-name">{t("color.name.deepNavy")}</h3>
                    <p class="color-hex">#1E3A8A</p>
                    <p class="color-description">{t("color.desc.deepNavy")}</p>
                    <button class="copy-hex" data-color="#1E3A8A"
                        >Copy HEX</button
                    >
                </div>
            </div>

            <div class="color-card">
                <div class="color-swatch" style="background-color: #B45309;">
                    <div
                        style="color: white; text-align: center; padding: 20px;"
                    >
                        <h3 style="color: white; margin-bottom: 10px;">
                            {t("color.accent1")}
                        </h3>
                        <p style="color: rgba(255,255,255,0.9);">
                            {t("color.accent1.desc")}
                        </p>
                    </div>
                </div>
                <div class="color-info">
                    <h3 class="color-name">{t("color.name.terracotta")}</h3>
                    <p class="color-hex">#B45309</p>
                    <p class="color-description">
                        {t("color.desc.terracotta")}
                    </p>
                    <button class="copy-hex" data-color="#B45309"
                        >Copy HEX</button
                    >
                </div>
            </div>

            <div class="color-card">
                <div class="color-swatch" style="background-color: #0F766E;">
                    <div
                        style="color: white; text-align: center; padding: 20px;"
                    >
                        <h3 style="color: white; margin-bottom: 10px;">
                            {t("color.accent2")}
                        </h3>
                        <p style="color: rgba(255,255,255,0.9);">
                            {t("color.accent2.desc")}
                        </p>
                    </div>
                </div>
                <div class="color-info">
                    <h3 class="color-name">{t("color.name.minimalTeal")}</h3>
                    <p class="color-hex">#0F766E</p>
                    <p class="color-description">
                        {t("color.desc.minimalTeal")}
                    </p>
                    <button class="copy-hex" data-color="#0F766E"
                        >Copy HEX</button
                    >
                </div>
            </div>

            <div class="color-card">
                <div class="color-swatch" style="background-color: #374151;">
                    <div
                        style="color: white; text-align: center; padding: 20px;"
                    >
                        <h3 style="color: white; margin-bottom: 10px;">
                            {t("color.text.light")}
                        </h3>
                        <!-- Reusing generic 'text light/charcoal' if key doesn't fit perfectly -->
                        <p style="color: rgba(255,255,255,0.9);">
                            {t("color.text.charcoal.desc")}
                        </p>
                    </div>
                </div>
                <div class="color-info">
                    <h3 class="color-name">{t("color.text.charcoal")}</h3>
                    <p class="color-hex">#374151</p>
                    <p class="color-description">
                        {t("color.text.charcoal.desc")}
                    </p>
                    <button class="copy-hex" data-color="#374151"
                        >Copy HEX</button
                    >
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    // Color mode toggle functionality and Copy HEX
    const modeButtons = document.querySelectorAll(".mode-btn");
    const darkModeColors = document.getElementById("darkModeColors");
    const lightModeColors = document.getElementById("lightModeColors");
    const body = document.body;

    // Sync with initial state
    if (body.classList.contains("light-mode")) {
        updateUI("light");
    }

    function updateUI(mode: string | null) {
        if (!mode) return;
        if (modeButtons.length > 0) {
            modeButtons.forEach((btn) => btn.classList.remove("active"));
            if (mode === "light") {
                if (darkModeColors) darkModeColors.style.display = "none";
                if (lightModeColors) lightModeColors.style.display = "grid";
                const btn = document.querySelector(
                    '.mode-btn[data-mode="light"]',
                );
                if (btn) btn.classList.add("active");
            } else {
                if (darkModeColors) darkModeColors.style.display = "grid";
                if (lightModeColors) lightModeColors.style.display = "none";
                const btn = document.querySelector(
                    '.mode-btn[data-mode="dark"]',
                );
                if (btn) btn.classList.add("active");
            }
        }
    }

    modeButtons.forEach((button) => {
        button.addEventListener("click", () => {
            const mode = button.getAttribute("data-mode");

            // Dispatch event for other components (Header/ThemeToggle)
            if (mode === "light") {
                body.classList.add("light-mode");
                localStorage.setItem("theme", "light");
            } else {
                body.classList.remove("light-mode");
                localStorage.setItem("theme", "dark");
            }
            updateUI(mode);
            // We don't have a clean way to update the Floating Toggle icon without reloading or event listener there.
            // But if we use a shared logic or just let the mutation observer (if any) handle it.
            // Actually, best way is to trigger a simulated click on the toggle OR dispatch a window event.
            // Let's dispatch the same event ThemeToggle uses/listens for.
            window.dispatchEvent(
                new CustomEvent("themeChanged", { detail: { theme: mode } }),
            );
        });
    });

    // Listen for changes from floating toggle
    window.addEventListener("themeChanged", (e: any) => {
        updateUI(e.detail.theme);
    });

    // Copy HEX code functionality
    const copyButtons = document.querySelectorAll(".copy-hex");

    copyButtons.forEach((button) => {
        button.addEventListener("click", () => {
            const hexCode = button.getAttribute("data-color");

            if (hexCode) {
                // Copy to clipboard
                navigator.clipboard
                    .writeText(hexCode)
                    .then(() => {
                        // Show feedback
                        const originalText = button.textContent;
                        button.textContent = "Copied!";
                        button.classList.add("copied");

                        // Reset after 2 seconds
                        setTimeout(() => {
                            button.textContent = originalText;
                            button.classList.remove("copied");
                        }, 2000);
                    })
                    .catch((err) => {
                        console.error("Failed to copy: ", err);
                        button.textContent = "Error!";

                        setTimeout(() => {
                            button.textContent = "Copy HEX";
                        }, 2000);
                    });
            }
        });
    });
</script>

<style>
    .color-palette-section {
        padding: 80px 0;
        background-color: var(--bg-secondary);
        transition: background-color var(--transition-speed);
    }

    .section-description {
        text-align: center;
        max-width: 800px;
        margin: 0 auto 60px;
        color: var(--text-secondary);
        font-size: 1.1rem;
        line-height: 1.8;
        transition: color var(--transition-speed);
    }

    /* Color Mode Toggle */
    .color-mode-toggle {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 40px;
    }

    .mode-btn {
        padding: 12px 30px;
        border: 2px solid var(--primary-color);
        background: transparent;
        color: var(--primary-color);
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }

    .mode-btn.active {
        background-color: var(--primary-color);
        color: white;
    }

    .mode-btn:hover:not(.active) {
        background-color: var(--primary-color);
        color: white;
        transform: translateY(-2px);
    }

    /* Color Cards */
    .color-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 30px;
        margin-bottom: 80px;
    }

    .color-card {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 10px 30px var(--shadow-color);
        transition: all 0.3s;
    }

    .color-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px var(--shadow-color);
    }

    .color-swatch {
        height: 180px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    .color-info {
        padding: 25px;
        background-color: var(--card-bg);
        transition: background-color var(--transition-speed);
    }

    .color-name {
        font-size: 1.4rem;
        font-weight: 700;
        margin-bottom: 10px;
        color: var(--text-primary);
        transition: color var(--transition-speed);
    }

    .color-hex {
        font-size: 1.1rem;
        font-family: "Courier New", monospace;
        margin-bottom: 15px;
        color: var(--text-secondary);
        transition: color var(--transition-speed);
    }

    .color-description {
        font-size: 1rem;
        line-height: 1.6;
        color: var(--text-secondary);
        transition: color var(--transition-speed);
    }

    .copy-hex {
        margin-top: 15px;
        padding: 8px 16px;
        background-color: transparent;
        border: 1px solid var(--primary-color);
        color: var(--primary-color);
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s;
    }

    .copy-hex:hover {
        background-color: var(--primary-color);
        color: white;
    }

    .copy-hex.copied {
        background-color: var(--accent-2);
        border-color: var(--accent-2);
        color: white;
    }

    @media (max-width: 1200px) {
        .color-cards {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .color-cards {
            grid-template-columns: 1fr;
        }

        .color-mode-toggle {
            flex-direction: column;
            align-items: center;
        }

        .mode-btn {
            width: 200px;
        }
    }
</style>
